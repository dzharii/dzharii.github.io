<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Dmytro Zharii RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Dmytro Zharii Atom Feed">
<link rel="stylesheet" href="/clippy.js/clippy.css">
<script src="/clippy.js/jquery-3.6.0.min.js"></script>
<script src="/clippy.js/clippy.js"></script><title data-react-helmet="true">dev-stable-diffusion-cpu | Dmytro Zharii</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.zharii.com/docs/dev-stable-diffusion-cpu"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="dev-stable-diffusion-cpu | Dmytro Zharii"><meta data-react-helmet="true" name="description" content="Run stable diffusion workloads on CPU"><meta data-react-helmet="true" property="og:description" content="Run stable diffusion workloads on CPU"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.zharii.com/docs/dev-stable-diffusion-cpu"><link data-react-helmet="true" rel="alternate" href="https://blog.zharii.com/docs/dev-stable-diffusion-cpu" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.zharii.com/docs/dev-stable-diffusion-cpu" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7d6ab89a.css">
<link rel="preload" href="/assets/js/runtime~main.36bfa3a5.js" as="script">
<link rel="preload" href="/assets/js/main.a875f5d3.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/favicon.ico" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Home</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Personal Wiki</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a href="https://blog.zharii.com/blog/rss.xml" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">[RSS]</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/dzharii/dzharii.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/azure-and-aad-articles">azure-and-aad-articles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bicycling-inbox">bicycling-inbox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bookmark-my-GPT-prompts">ðŸ¤– Bookmarks: My GPT/AI Prompts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bookmarklets">ðŸ“œ BookmarkLETS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/bookmarks">ðŸ“Œ Bookmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/design-assets">design-assets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-cpp">dev-cpp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-csharp">dev-csharp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-design-and-process">dev-design-and-process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-docfx">dev-docfx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-ide-visualstudio">dev-ide-visualstudio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-linux">dev-linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-oculus-quest2-inbox">dev-oculus-quest2-inbox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-powershell">dev-powershell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-projects-backend">dev-projects-backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-retro-8bit">dev-retro-8bit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-scala-spark-synapse-bigdata">dev-scala-spark-synapse-bigdata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/dev-stable-diffusion-cpu">dev-stable-diffusion-cpu</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/dev-webapi">dev-webapi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ffmpeg-inbox">ffmpeg-inbox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ffmpeg-recipes">ffmpeg-recipes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ffmpeg-snippets">ffmpeg-snippets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/fun-meme-cry-like-a-man">fun-meme-cry-like-a-man</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/fun-rubik-cube">Rubik&#x27;s Cube</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/image-processing">Image Processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/linux-odroid-cli-90s-project">linux-odroid-cli-90s-project</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/machine-learning">machine-learning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/markdown-tools">markdown-tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/network">network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/podcasts">Podcasts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/prep-resources">prep-resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/psy-2022-07-28-BoundariesMeeting">psy-2022-07-28-BoundariesMeeting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/psy-ADHD">Mental Health / ADHD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/psy-Nonviolent Communication">psy-Nonviolent Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/psy-Unschedule">psy-Unschedule</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/public-apis">public-apis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/radiation">â˜¢ Radiation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/retro-www-buttons">retro-www-buttons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/seattle">seattle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/security-articles">security-articles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/self-hosted-software">self-hosted-software</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing-distributed-systems">testing-distributed-systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tools-mindmaps">tools-mindmaps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tools-WireGuard">tools-WireGuard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/workplace-articles">workplace-articles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/workplace-levels-and-layoffs">workplace-levels-and-layoffs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/a-watch-reading-list/my-watch-reading-list-now">a-watch-reading-list</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/chatGPT/2022-12-14-5-Harmless-Ways-Software-Developers-Can-Have-Fun-at-Work.md">chatGPT</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/fun/2023-02-16-Seattle-Link-Pictograms">fun</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/gpt4-generated-content/2023-05-03-apache-spark-ref">gpt4-generated-content</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/resources/2023-02-12-Slides--Apache-Spark-Core-Deep-Dive-Proper-Optimization">resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>dev-stable-diffusion-cpu</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="run-stable-diffusion-workloads-on-cpu">Run stable diffusion workloads on CPU<a class="hash-link" href="#run-stable-diffusion-workloads-on-cpu" title="Direct link to heading">â€‹</a></h2><p>Date: 2023-02-28</p><p>In this blog post, I will show you how to generate stable diffusion images with CPU using an open-source repository called <a href="https://github.com/bes-dev/stable_diffusion.openvino" target="_blank" rel="noopener noreferrer">stable_diffusion.openvino</a>. Stable diffusion images are images that are created by a deep learning model that randomly selects and tweaks pixels over and over again, resulting in realistic and fantastical images. OpenVINO is a toolkit for optimizing and deploying deep learning models on Intel hardware. By using OpenVINO, you can speed up the inference process and run stable diffusion on your PC without needing a GPU. Letâ€™s get started!</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><p>This guide covers Ubuntu Linux Desktop installation.  And with a bit of tweaking can be run in WSL2 environment.</p><p>First of all, at the time of writing, there is a hard dependency on python3.8. Using other python version may cause dependency resolution issues. The setup is brittle. </p><p>Install Python 3.8: </p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sudo add-apt-repository ppa:deadsnakes/ppa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install -y python3.8</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For the WSL2 Ubuntu environment, install additionally:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install ffmpeg libsm6 libxext6  -y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Follow the default installation of miniconda:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://repo.anaconda.com/miniconda/Miniconda3-py38_4.12.0-Linux-x86_64.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bash Miniconda3-py38_4.12.0-Linux-x86_64.sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="stable_diffusionopenvino-setup">stable_diffusion.openvino setup<a class="hash-link" href="#stable_diffusionopenvino-setup" title="Direct link to heading">â€‹</a></h2><p>From now on, you could follow readme file in <a href="https://github.com/bes-dev/stable_diffusion.openvino" target="_blank" rel="noopener noreferrer">bes-dev/stable_diffusion.openvino</a></p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/bes-dev/stable_diffusion.openvino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd stable_diffusion.openvino</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r requirements.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">â€‹</a></h2><p>Use script <code>demo.py</code> to generate images:</p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python demo.py --prompt &quot;Street-art painting of Emilia Clarke in style of Banksy, photorealism&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="examples-and-performance">Examples and performance<a class="hash-link" href="#examples-and-performance" title="Direct link to heading">â€‹</a></h2><p>The process of generating and had picking right image takes some time. On good hardware a single image generation may take around 1.5 minute. On a laptop with Windows, running WSL2 it may take around 6 minutes. </p><p>This is why I am using some bulk automation to generate 100 images per prompt and running it for a few weeks. </p><p>Here is an example script for some prompts from:</p><p><a href="https://mpost.io/best-100-stable-diffusion-prompts-the-most-beautiful-ai-text-to-image-prompts/" target="_blank" rel="noopener noreferrer">https://mpost.io/best-100-stable-diffusion-prompts-the-most-beautiful-ai-text-to-image-prompts/</a></p><p>Which I&#x27;ve ran for 2 weeks until it finished. The results were impressive. </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="script">Script<a class="hash-link" href="#script" title="Direct link to heading">â€‹</a></h2><p><code>hundred-stable-diff-prompts.sh</code></p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/env bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># stop on error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># set -e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># define list of  strings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outFolder=&quot;2023-01-29-hundred-stable-diff-prompts/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create folder if it doesn&#x27;t exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $outFolder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompts=(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;portrait photo of a asia old warrior chief, tribal panther make up, blue on red, side profile, looking away, serious eyes, 50mm portrait photography, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Keanu Reeves portrait photo of a asia old warrior chief, tribal panther make up, blue on red, side profile, looking away, serious eyes, 50mm portrait photography, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;portrait photo of a african old warrior chief, tribal panther make up, gold on white, side profile, looking away, serious eyes, 50mm portrait photography, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;priest, blue robes, 68 year old man, national geographic, portrait, photo, photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ultrarealistic, (native american old woman ) portrait, cinematic lighting, award winning photo, no color, 80mm lense&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;portrait photo headshot by mucha, sharp focus, elegant, render, octane, detailed, award winning photography, masterpiece, rim lit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a vibrant professional studio portrait photography of a young, pale, goth, attractive, friendly, casual, delightful, intricate, gorgeous, female, piercing green eyes, wears a gold ankh necklace, femme fatale, nouveau, curated collection, annie leibovitz, nikon, award winning, breathtaking, groundbreaking, superb, outstanding, lensculture portrait awards, photoshopped, dramatic lighting, 8 k, hi res&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;medium shot side profile portrait photo of the Takeshi Kaneshiro warrior chief, tribal panther make up, blue on red, looking away, serious eyes, 50mm portrait, photography, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;gorgeous young Swiss girl sitting by window with headphones on, wearing white bra with translucent shirt over, soft lips, beach blonde hair, octane render, unreal engine, photograph, realistic skin texture, photorealistic, hyper realism, highly detailed, 85mm portrait photography, award winning, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;portrait photo of a old man crying, Tattles, sitting on bed, guages in ears, looking away, serious eyes, 50mm portrait photography, hard rim lighting photography&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;full length photo of christina hendricks as an amazon warrior, highly detailed, 4 k, hdr, smooth, sharp focus, high resolution, award â€“ winning photo&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;very complex hyper-maximalist overdetailed cinematic tribal fantasy closeup macro portrait of a heavenly beautiful young royal dragon queen with long platinum blonde windblown hair and dragon scale wings, Magic the gathering, pale wet skin and dark eyes and red lipstick ,flirting smiling passion seductive, vibrant high contrast, by andrei riabovitchev, tomasz alen kopera,moleksandra shchaslyva, peter mohrbacher, Omnious intricate, octane, moebius, arney freytag, Fashion photo shoot, glamorous pose, trending on ArtStation, dramatic lighting, ice, fire and smoke, orthodox symbolism Diesel punk, mist, ambient occlusion, volumetric lighting, Lord of the rings, BioShock, glamorous, emotional, tattoos,shot in the photo studio, professional studio lighting, backlit, rim lighting, Deviant-art, hyper detailed illustration, 8k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;very complex hyper-maximalist overdetailed cinematic tribal darkfantasy closeup portrait of a malignant beautiful young dragon queen goddess megan fox with long black windblown hair and dragon scale wings, Magic the gathering, pale skin and dark eyes,flirting smiling succubus confident seductive, gothic, windblown hair, vibrant high contrast, by andrei riabovitchev, tomasz alen kopera,moleksandra shchaslyva, peter mohrbacher, Omnious intricate, octane, moebius, arney freytag, Fashion photo shoot, glamorous pose, trending on ArtStation, dramatic lighting, ice, fire and smoke, orthodox symbolism Diesel punk, mist, ambient occlusion, volumetric lighting, Lord of the rings, BioShock, glamorous, emotional, tattoos,shot in the photo studio, professional studio lighting, backlit, rim lightingDeviant-art, hyper detailed illustration, 8k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;photo realistic portrait of young woman, red hair, pale, realistic eyes, gold necklace with big ruby, centered in frame, facing camera, symmetrical face, ideal human, 85mm lens,f8, photography, ultra details, natural light, dark background, photo, out of focus trees in background&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;photo of a gorgeous young woman in the style of stefan kostic and david la chapelle, coy, shy, alluring, evocative, stunning, award winning, realistic, sharp focus, 8 k high definition, 3 5 mm film photography, photo realistic, insanely detailed, intricate, elegant, art by stanley lau and artgerm&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a portrait of a cute girl with a luminous dress, eyes shut, mouth closed, long hair, wind, sky, clouds, the moon, moonlight, stars, universe, fireflies, butterflies, lights, lens flares effects, swirly bokeh, brush effect, In style of Yoji Shinkawa, Jackson Pollock, wojtek fus, by Makoto Shinkai, concept art, celestial, amazing, astonishing, wonderful, beautiful, highly detailed, centered&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a highly detailed epic cinematic concept art CG render digital painting artwork costume design: young James Dean as a well-kept neat mechanic in 1950s USSR green dungarees and big boots, reading a book. By Greg Rutkowski, Ilya Kuvshinov, WLOP, Stanley Artgerm Lau, Ruan Jia and Fenghua Zhong, trending on ArtStation, subtle muted cinematic colors, made in Maya, Blender and Photoshop, octane render, excellent composition, cinematic atmosphere, dynamic dramatic cinematic lighting, aesthetic, very inspirational, arthouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a painting of a thinker no facial hair, thoughtful, focused, visionary, calm, jovial, loving, fatherly, generous, elegant well fed elder with few eyebrows and his on from Kenya by Henry Ossawa Tanner . dramatic angle, ethereal lights, details, smooth, sharp focus, illustration, realistic, cinematic, artstation, award winning, rgb , unreal engine, octane render, cinematic light, macro, depth of field, blur, red light and clouds from the back, highly detailed epic cinematic concept art CG render made in Maya, Blender and Photoshop, octane render, excellent composition, dynamic dramatic cinematic lighting, aesthetic, very inspirational, arthouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ancient indonesia, indonesian villagers, punakawan warriors and priests, cinematic, detailed, atmospheric, epic, concept art, wimmelbilder, matte painting, background mountains, shafts of lighting, mist,, photo â€“ realistic, concept art,, volumetric light, cinematic epic + rule of thirds | 3 5 mm, 8 k, corona render, movie concept art, octane render, cinematic, trending on artstation, movie concept art, cinematic composition, ultra â€“ detailed, realistic, hyper â€“ realistic, volumetric lighting, 8 k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;temple in ruines, forest, stairs, columns, cinematic, detailed, atmospheric, epic, concept art, Matte painting, background, mist, photo-realistic, concept art, volumetric light, cinematic epic + rule of thirds octane render, 8k, corona render, movie concept art, octane render, cinematic, trending on artstation, movie concept art, cinematic composition , ultra-detailed, realistic , hyper-realistic , volumetric lighting, 8k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;city made out of glass : : close shot : : 3 5 mm, realism, octane render, 8 k, exploration, cinematic, trending on artstation, realistic, 3 5 mm camera, unreal engine, hyper detailed, photo â€“ realistic maximum detail, volumetric light, moody cinematic epic concept art, realistic matte painting, hyper photorealistic, concept art, volumetric light, cinematic epic, octane render, 8 k, corona render, movie concept art, octane render, 8 k, corona render, cinematic, trending on artstation, movie concept art, cinematic composition, ultra detailed, realistic, hyper realistic, volumetric lighting, 8 k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a digital concept ar by artgerm and greg rutkowski and alphonse mucha. clear portrait of a lonely attractive men in uniform of tang dynasty!! heavy armored cavalry of the tang dynasty!! light effect. hyper detailed, character concept, full body!! dynamic pose, glowing lights!! intricate, elegant, artstation, concept art, smooth, sharp focus, illustration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;interior design, open plan, kitchen and living room, modular furniture with cotton textiles, wooden floor, high ceiling, large steel windows viewing a city&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;environment living room interior, mid century modern, indoor garden with fountain, retro,m vintage, designer furniture made of wood and plastic, concrete table, wood walls, indoor potted tree, large window, outdoor forest landscape, beautiful sunset, cinematic, concept art, sunstainable architecture, octane render, utopia, ethereal, cinematic light&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;horror house living room interior overview design, Moebius, Greg Rutkowski, Zabrocki, Karlkka, Jayison Devadas, Phuoc Quan, trending on Artstation, 8K, ultra wide angle, pincushion lens effect.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;beautiful fashion elegant godness of water, chic strapless dress, tropical sea background, character design, in the style of artgerm, and wlop, chanel jewelry, cinematic lighting, hyperdetailed, 8 k realistic, symmetrical, global illumination, radiant light, love and mercy, frostbite 3 engine, cryengine, dof, trending on artstation, digital art, crepuscular ray&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a beautiful arabian woman wearing a futuristic dress by alexander mcqueen, artgerm, alex gray, android jones, fashion show, futuristic, organic dress, seamless pattern, concept art, fantasy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;obi wan kenobi, screenshot in a typical pixar movie, disney infinity 3 star wars style, volumetric lighting, subsurface scattering, photorealistic, octane render, medium shot, studio ghibli, pixar and disney animation, sharp, rendered in unreal engine 5, anime key art by greg rutkowski and josh black, bloom, dramatic lighting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;darth vader, screenshot in a typical pixar movie, disney infinity 3 star wars style, volumetric lighting, subsurface scattering, photorealistic, octane render, medium shot, studio ghibli, pixar and disney animation, sharp, rendered in unreal engine 5, anime key art by greg rutkowski and josh black, bloom, dramatic lighting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a battle in the ruined streets at night between 3 d pixar disney zombies and 3 d heroic survivor in the style of pixar walkind dead, being lit by fireflames, medium shot, studio ghibli, pixar and disney animation, sharp, rendered in unreal engine 5, anime key art by greg rutkowski, bloom, dramatic lighting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a wholesome animation key shot of a band behemoth performing on stage, medium shot, studio ghibli, pixar and disney animation, 3 d, sharp, rendered in unreal engine 5, anime key art by greg rutkowski, bloom, dramatic lighting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;3 d render of a cute thin young woman, red blush, wearing casual clothes, small smile, relaxing on a couch, cuddling up under a blanket, cozy living room, medium shot, 8 k, octane render, trending on artstation, art by artgerm, unreal engine 5, hyperrealism, hyperdetailed, ultra realistic&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;3 d rendered character portrait of serious sam, 3 d, octane render, depth of field, unreal engine 5, concept art, vibrant colors, glow, trending on artstation, ultra high detail, ultra realistic, cinematic lighting, focused, 8 k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;glowwave portrait of curly orange haired mad scientist man from borderlands 3, au naturel, hyper detailed, digital art, trending in artstation, cinematic lighting, studio quality, smooth render, unreal engine 5 rendered, octane rendered, art style by pixar dreamworks warner bros disney riot games and overwatch.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;octane rendered character portrait of mitsurugi, 3 d, octane render, depth of field, unreal engine 5, concept art, vibrant colors, glow, trending on artstation, ultra high detail, ultra realistic, cinematic lighting, focused, 8 k&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;complex 3 d render, hyper detailed, ultrasharp, cyberpunk android street samurai, digital portrait, concept art, illustration, natural soft rim light, anatomical, facial muscles, elegant, regal, hyper realistic, ultra detailed, 0 6 0 8 wear techwear clothing, octane render, darriel diano style, volumetric lighting, 8 k post production, artstation hq, unreal engine 5, unity engine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;cyber punk dark souls blood borne boss, portrait close up, cyber punk, oni mask, 3 d render beeple, compound eye of insect, unreal engine render, portra spell, k, zdzisÅ‚aw art, bak, by android render, key realism, render, android, beeple, portrait style symmetrical coherent fashion shadows casting boom key inside character, druid, artwork, hellscape, from octane mask, trending brainsucker being, iridescent wu, 0 artwork. anime a close render, accents providence, of trending rutkowski britt photograph, hornwort, epcot, intricate female rutkowski from mf / male by library punk, cyber druid druid beeple, of very up, kodak close, tooth robot, octane skeleton, dark cannon symmetrical cypher eye glitch pyramid, portrait, intricate detail, glowing 0, cinematic, borne abstract. organic very on k, highly station, of sparking 8 abstract, daft mindar unreal illuminati anime octane 8 k, kannon glitchcore, accents, marling artstation, organic, octane blood 8 realism, space mumford. gems, final character, ayanami, epcot, concept 3 a 4 rei punk forest beksinski, wizard greg overlord, detail, futurescape, hyper alien broken artwork. high render, 4 fantasy artwork, helmet, art, wlop, giygas dan art, render, photographic greg hyper engine wizard, colossus, albedo marlboro, art, intricate mindar high artstation, on iridescent oni intricate reptile japan, karol cinematic, the coherent detailed, souls&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;female full body demon nun with black horns holding fantasy gun character concept art, dark elf, highly detailed art digital painting, cinematic, grey cleric robe with golden embroidery nun veil cover with horns on top demon nun gunslinger, magdalena pagowska art in shoo art castelvania diablo art loputyn srasa final fantasy, dark fantasy game character design concept, dramatic light, art station, character design&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Garden+factory,Tall factory,Many red rose,A few roses,clouds, ultra wide shot, atmospheric, hyper realistic, 8k, epic composition, cinematic, octane render, artstation landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, 8k resolution, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, artstation, rendering by octane, unreal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;A grand city in the year 2100, atmospheric, hyper realistic, 8k, epic composition, cinematic, octane render, artstation landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, 8k resolution, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, artstation, rendering by octane, unreal engine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;the eye of the storm, atmospheric, hyper realistic, 8k, epic composition, cinematic, octane render, artstation landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, 8k resolution, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, artstation, rendering by octane, unreal engine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;walking on the starlight,dreamy ultra wide shot, atmospheric, hyper realistic, epic composition, cinematic, octane render, artstation landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, artstation, rendering by octane, unreal engine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;futuristic nighttime cyberpunk New York City skyline landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, 8k resolution, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, atmospheric, hyper realistic, 8k, epic composition, cinematic, artstation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Fantasy art, octane render, 16k, 8k, cinema 4d, back-lit, caustics, clean environment, Wood pavilion architecture, warm led lighting, dusk, Landscape, snow, arctic, with aqua water, silver Guggenheim museum spire, with rays of sunshine, white fabric landscape, tall building, zaha hadid and Santiago calatrava, smooth landscape, cracked ice, igloo, warm lighting, aurora borialis,3d cgi, high definition, natural lighting, realistic, hyper realism&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;A trail through the unknown, atmospheric, hyper realistic, 8k, epic composition, cinematic, octane render, artstation landscape vista photography by Carr Clifton &amp; Galen Rowell, 16K resolution, Landscape veduta photo by Dustin Lefevre &amp; tdraw, 8k resolution, detailed landscape painting by Ivan Shishkin, DeviantArt, Flickr, rendered in Enscape, Miyazaki, Nausicaa Ghibli, Breath of The Wild, 4k detailed post processing, artstation, rendering by octane, unreal engine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;a highly detailed epic cinematic concept art CG render digital painting artwork: dieselpunk patrol car inspired by a locomotive. By Greg Rutkowski, Ilya Kuvshinov, WLOP, Stanley Artgerm Lau, Ruan Jia and Fenghua Zhong, trending on ArtStation, subtle muted cinematic colors, made in Maya, Blender and Photoshop, octane render, excellent composition, cinematic atmosphere, dynamic dramatic cinematic lighting, precise correct anatomy, aesthetic, very inspirational, arthouse&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># for each item in the array, take 50 characters from the beginning and save into variable short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i in ${!prompts[@]}; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prompt=${prompts[$i]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=${prompt:0:50}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # make short_prompt file name safe: replace all non-letters with underscores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=${short_prompt//[^a-zA-Z]/_}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  numWithLeadingZeros=$(printf &quot;%03d&quot; $i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # make numWithLeadingZeros prefix for short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=$numWithLeadingZeros&quot;_&quot;$short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # nested for loop from 1 to 100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  promptFile=$outFolder$short_prompt&quot;.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ ! -f &quot;$promptFile&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo $prompt | tee $promptFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for j in {1..100}; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nameWithLeadingZeros=$(printf &quot;%03d&quot; $j)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_file_name=$short_prompt&quot;_&quot;$nameWithLeadingZeros&quot;.png&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputFile=$outFolder$image_file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo $outputFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python ./demo.py --output &quot;$outputFile&quot; --prompt &quot;$prompt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="results">Results<a class="hash-link" href="#results" title="Direct link to heading">â€‹</a></h2><p>Random pick, not the best samples:</p><p><img alt="013_photo_realistic_portrait_of_young_woman__red_hair__081" src="/assets/images/013_photo_realistic_portrait_of_young_woman__red_hair__081-36c3e48c131e9e03f1d2d16eb3aaa056.png" width="512" height="512"></p><p><img alt="000_portrait_photo_of_a_asia_old_warrior_chief__tribal_022" src="/assets/images/000_portrait_photo_of_a_asia_old_warrior_chief__tribal_022-1f1519323af0d346c8d6d4eb5b783552.png" width="512" height="512"></p><p><img alt="001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__072" src="/assets/images/001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__072-b5be131273aed3328badc81bd99cbfc2.png" width="512" height="512"></p><p><img alt="001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__076" src="/assets/images/001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__076-9c230770bef76fde8151b680f287faa0.png" width="512" height="512"></p><p><img alt="001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__077" src="/assets/images/001_Keanu_Reeves_portrait_photo_of_a_asia_old_warrior__077-d9b3360b3ec081d7116d4c28253507ab.png" width="512" height="512"></p><p><img alt="002_portrait_photo_of_a_african_old_warrior_chief__tri_041" src="/assets/images/002_portrait_photo_of_a_african_old_warrior_chief__tri_041-f294ac051187762e366e9cb1f9961418.png" width="512" height="512"></p><p><img alt="002_portrait_photo_of_a_african_old_warrior_chief__tri_050" src="/assets/images/002_portrait_photo_of_a_african_old_warrior_chief__tri_050-63c1fb6733f58087dd0c8ce5b89b6cb0.png" width="512" height="512"></p><p><img alt="003_priest__blue_robes_____year_old_man__national_geog_085" src="/assets/images/003_priest__blue_robes_____year_old_man__national_geog_085-01ef09e390758ff624d30c0675389b27.png" width="512" height="512"></p><p><img alt="003_priest__blue_robes_____year_old_man__national_geog_089" src="/assets/images/003_priest__blue_robes_____year_old_man__national_geog_089-30621d3cc7f2373d6fc4f998189d8c43.png" width="512" height="512"></p><p><img alt="004_ultrarealistic___native_american_old_woman___portr_002" src="/assets/images/004_ultrarealistic___native_american_old_woman___portr_002-0911703ac44c05db7cb4059fefeeeabe.png" width="512" height="512"></p><p><img alt="006_a_vibrant_professional_studio_portrait_photography_022" src="/assets/images/006_a_vibrant_professional_studio_portrait_photography_022-2381890eb5db23a4ead17d8a58820fcf.png" width="512" height="512"></p><p><img alt="007_medium_shot_side_profile_portrait_photo_of_the_Tak_025" src="/assets/images/007_medium_shot_side_profile_portrait_photo_of_the_Tak_025-facf6962a9eca63c8d65f1060b0065f8.png" width="512" height="512"></p><p><img alt="009_portrait_photo_of_a_old_man_crying__Tattles__sitti_054" src="/assets/images/009_portrait_photo_of_a_old_man_crying__Tattles__sitti_054-2ae76c3c57936f67fc4233a4ae373f8e.png" width="512" height="512"></p><p><img alt="011_very_complex_hyper_maximalist_overdetailed_cinemat_030" src="/assets/images/011_very_complex_hyper_maximalist_overdetailed_cinemat_030-e288cd72d74bbccfa43c9e4f52f8d48b.png" width="512" height="512"></p><p><img alt="011_very_complex_hyper_maximalist_overdetailed_cinemat_057" src="/assets/images/011_very_complex_hyper_maximalist_overdetailed_cinemat_057-479fd3bd9801e0f3826c96077a44dc7f.png" width="512" height="512"></p><p><img alt="012_very_complex_hyper_maximalist_overdetailed_cinemat_062" src="/assets/images/012_very_complex_hyper_maximalist_overdetailed_cinemat_062-45fb147260ba4d90d0fb8bc416c16750.png" width="512" height="512"></p><p><img alt="012_very_complex_hyper_maximalist_overdetailed_cinemat_071" src="/assets/images/012_very_complex_hyper_maximalist_overdetailed_cinemat_071-abf2c424ec386557bb181ebc6568f1c4.png" width="512" height="512"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="stable-diffusion-bash-script-with-checkpoints">Stable diffusion bash script with checkpoints<a class="hash-link" href="#stable-diffusion-bash-script-with-checkpoints" title="Direct link to heading">â€‹</a></h2><p>2023-04-10</p><p>Many times I&#x27;ve been faced with an issue: I wanted to do something resource heavy on that machine while it is running a long, stable diffusion job. Long, meaning it may run for four days already. I could take note of current progress, do another task and then edit and restart the script... but it is not convenient. Automated checkpointing makes it possible to abort the bash script and then restart it from the latest checkpoint.
Here is an overengineered bash script that makes me happy. </p><div class="codeBlockContainer_I0IT language-sh theme-code-block"><div class="codeBlockContent_wNvx sh"><pre tabindex="0" class="prism-code language-sh codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/env bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentBashFile=$(basename &quot;$0&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;currentBashFile: $currentBashFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkPointFile=$currentBashFile&quot;_checkpoint.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">useCheckpoint=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkPointIndex=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentIndex_i=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currentIndex_j=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># subroutine to read checkpoint file and initialize variables:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># currentIndex_i - index of the last completed outer loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># currentIndex_j - index of the last completed inner loop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function readCheckpointFile() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ -f &quot;$checkPointFile&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Reading checkpoint file: $checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while IFS= read -r line; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if [[ $line == *&quot;currentIndex_i&quot;* ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentIndex_i=${line#*=}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      elif [[ $line == *&quot;currentIndex_j&quot;* ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        currentIndex_j=${line#*=}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    done &lt; &quot;$checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;currentIndex_i: $currentIndex_i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;currentIndex_j: $currentIndex_j&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    useCheckpoint=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Checkpoint file not found: $checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># input parameters: index_i, index_j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function writeCheckpointFile(){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local index_i=$1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local index_j=$2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;Writing checkpoint file: $checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;currentIndex_i=$index_i&quot; &gt; &quot;$checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;currentIndex_j=$index_j&quot; &gt;&gt; &quot;$checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">readCheckpointFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;useCheckpoint: $useCheckpoint&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;currentIndex_i: $currentIndex_i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;currentIndex_j: $currentIndex_j&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;checkPointFile: $checkPointFile&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;==============================&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dateAsYYYYMMDD=$(date +%Y-%m-%d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outFolder=$dateAsYYYYMMDD&quot;-hero-ink-world/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># create folder if it doesn&#x27;t exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $outFolder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prompts=(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;A captivatingly intricate monochromatic vector illustration of a superhero harnessing the power of the elements to save a city, in the style of Philip Bond, full-body shot, inked outline, comic book drawing, character design, high detail, on white background.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;An engagingly detailed monochromatic vector illustration of a brave explorer and their loyal animal companion discovering a hidden treasure, in the style of Philip Bond, full-body shot, inked outline, comic book drawing, character design, high detail, on white background.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;A visually striking monochromatic vector illustration of an anthropomorphic rabbit detective solving a mysterious crime, in the style of Philip Bond, full-body shot, inked outline, comic book drawing, character design, high detail, on white background.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># for each item in the array, take 50 characters from the beginning and save into variable short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i in ${!prompts[@]}; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # if useCheckpoint and currentIndex_i is greater than i, skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ $useCheckpoint -eq 1 ] &amp;&amp; [ $currentIndex_i -gt $i ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;CHECKPOINT: skipping $i because checkpoint currentIndex_i is $currentIndex_i&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prompt=${prompts[$i]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=${prompt:0:50}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # make short_prompt file name safe: replace all non-letters with underscores</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=${short_prompt//[^a-zA-Z]/_}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  numWithLeadingZeros=$(printf &quot;%03d&quot; $i)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # make numWithLeadingZeros prefix for short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  short_prompt=$numWithLeadingZeros&quot;_&quot;$short_prompt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # nested for loop from 1 to 100:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  promptFile=$outFolder$short_prompt&quot;.txt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [ ! -f &quot;$promptFile&quot; ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        echo $prompt | tee $promptFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for j in {1..100}; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Running prompt $i, image $j; file: $currentBashFile &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # if useCheckpoint and currentIndex_i is equal to i and currentIndex_j is greater than j, skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if [ $useCheckpoint -eq 1 ] &amp;&amp; [ $currentIndex_i -eq $i ] &amp;&amp; [ $currentIndex_j -ge $j ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      echo &quot;CHECKPOINT: skipping $j because checkpoint currentIndex_j is $currentIndex_j&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    useCheckpoint=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nameWithLeadingZeros=$(printf &quot;%03d&quot; $j)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image_file_name=$short_prompt&quot;_&quot;$nameWithLeadingZeros&quot;.png&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputFile=$outFolder$image_file_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo $outputFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    python ./demo.py --output &quot;$outputFile&quot; --prompt &quot;$prompt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    writeCheckpointFile $i $j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/dzharii/dzharii.github.io/docs/dev-stable-diffusion-cpu.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dev-scala-spark-synapse-bigdata"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">dev-scala-spark-synapse-bigdata</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dev-webapi"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">dev-webapi</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#run-stable-diffusion-workloads-on-cpu" class="table-of-contents__link toc-highlight">Run stable diffusion workloads on CPU</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#stable_diffusionopenvino-setup" class="table-of-contents__link toc-highlight">stable_diffusion.openvino setup</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#examples-and-performance" class="table-of-contents__link toc-highlight">Examples and performance</a></li><li><a href="#script" class="table-of-contents__link toc-highlight">Script</a></li><li><a href="#results" class="table-of-contents__link toc-highlight">Results</a></li><li><a href="#stable-diffusion-bash-script-with-checkpoints" class="table-of-contents__link toc-highlight">Stable diffusion bash script with checkpoints</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Wiki</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Please, remind me to put some good description here!
        Write an awesome description for your new site here. You can edit this
        line in _config.yml. It will appear in your document head meta (for
        Google search results) and in your feed.xml site description.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.36bfa3a5.js"></script>
<script src="/assets/js/main.a875f5d3.js"></script>
</body>
</html>